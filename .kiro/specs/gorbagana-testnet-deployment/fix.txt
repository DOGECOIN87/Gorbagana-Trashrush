

It looks like you‚Äôre hitting two separate issues when running anchor build for your Solana program. Let‚Äôs break them down and then go over fixes:
1) error while loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory

This indicates that the anchor-cli (or some binary it uses) expects OpenSSL 1.1 libraries (libssl.so.1.1) but your system likely has a newer version (e.g., OpenSSL 3.x) where that library isn‚Äôt present.
Solana Stack Exchange+3Stack Overflow+3Solana Stack Exchange+3

Fixes
Here are ways to address this:

    Install the legacy OpenSSL 1.1 library version. On Ubuntu/Debian you might run:

    sudo apt update
    sudo apt install libssl1.1 libssl-dev pkg-config build-essential libudev-dev

    This was suggested in a thread about anchor test failing with this same error.
    Solana Stack Exchange+1

    If libssl1.1 package isn‚Äôt available for your distro (for example newer Ubuntu versions drop it in favor of OpenSSL 3), then you can either:

        Manually download a .deb for libssl1.1 (or equivalent) and install with dpkg.
        Solana Stack Exchange

        Or build/link your program/anchor CLI to use the newer OpenSSL (this is more work).

    After installing the correct library, you may need to run ldconfig or ensure the library path is available so anchor binary can find libssl.so.1.1.

Once this is resolved, the ‚Äúerror while loading shared libraries‚Äù message should go away.
2) error: failed to parse lock file at: ‚Ä¶ Cargo.lock ‚Ä¶ Caused by: lock file version 4 requires -Znext-lockfile-bump

This error is from Rust‚Äôs cargo tool chain. The lock file (Cargo.lock) version 4 is relatively new and older cargo versions don‚Äôt understand it.
NixOS Discourse+1

Your logs show you have cargo 1.84.1 and rustc 1.84.1 initially, and then you switched toolchains a few times. But the issue suggests the cargo version trying to parse the lock file is older than needed for version 4 lockfile format.

Fixes
Here are ways to address this:

    Upgrade cargo/rustc so that they support lock file version 4. The versioning for lock file format changed with Rust 1.78+ (which introduced lock file version 4) according to a discussion.
    NixOS Discourse+1

    So ensure you‚Äôre on at least Rust 1.78.0 or newer, and cargo matches that toolchain.

    If you are using workspaces or multiple toolchains, ensure the one being used for building (with anchor build / cargo build-bpf etc) is the correct (up-to‚Äêdate) toolchain.

    Alternatively, regenerate the Cargo.lock under a newer toolchain: You already did cargo generate-lockfile, which is good (this creates a lock file compatible with your current toolchain). If you keep using the older toolchain, you could consider downgrading the Cargo.lock version via patch, but better is to use a newer toolchain.
    NixOS Discourse

    Another note: In a workspace with multiple crates you might need workspace.resolver = "2" in your root Cargo.toml (if you decide to use edition 2021) to avoid other warnings about resolver versions (you saw a warning about that). This helps with compatibility of crates and lock files.

Suggested Combined Steps for Your Setup

Based on your logs and environment (Ubuntu derivative, anchor-cli 0.26.0, Rust toolchains switching, etc), here‚Äôs what I suggest:

    Install the missing library:

sudo apt update
sudo apt install libssl1.1 libssl-dev pkg-config build-essential libudev-dev

If your distro no longer has libssl1.1, you‚Äôll need to fetch a compatible .deb manually or use a workaround.

Confirm that the anchor binary can now start (run anchor --version) and doesn‚Äôt throw the libssl.so.1.1 error.

Ensure you‚Äôre using a Rust toolchain that supports lock file version 4. Set stable to e.g. rustup default stable if that‚Äôs 1.84.x. Then in your project root:

rustc --version
cargo --version

Regenerate the lock file:

cargo clean
cargo generate-lockfile

Then in your project root (where Anchor.toml is) run:

anchor build

If you encounter the ‚Äúsome crates are on edition 2021 ‚Ä¶ specify workspace.resolver = "2"‚Äù warning, you may choose to add this line in your root Cargo.toml:

    [workspace]
    resolver = "2"

    Make sure your anchor-cli version is compatible with your anchor-lang version in your program. You may want to update anchor-cli to a newer version (0.30+ maybe) if needed.

If you like, I can check the exact compatible versions of anchor-cli, anchor-lang, Rust toolchain, and Solana SDK recommended today (2025) for you, and we can align your environment. Would you like me to do that?
You said:
yes check
ChatGPT said:

Here are the current recommended compatible versions for a typical Anchor CLI + Solana CLI + Rust toolchain setup (as of 2025) ‚Äî and how they compare to what you‚Äôre using.
‚úÖ Recommended version alignment

From the official docs and release notes:

    Anchor docs recommend installing a recent version like anchor-cli 0.32.1.
    anchor-lang.com+1

    For Anchor v0.30.0, the release notes say: ‚Äúrecommended Solana version is 1.18.8‚Äù.
    anchor-lang.com

    For Anchor 0.29.0, the release notes state the minimum supported Solana version is 1.16.0.
    anchor-lang.com

    Many posts show version-mismatch issues when the Rust toolchain or Solana CLI ship an older Rust version than the dependencies expect.
    Solana Stack Exchange+2Solana Stack Exchange+2

So an aligned stack might look like:

    Solana CLI version ~ 1.18.x (or later)

    Anchor CLI version ~ 0.30.x‚Äì0.32.x

    Rust compiler (rustc) version ‚â• 1.75.0, preferably ~1.79‚Äì1.84 depending on exact crates

    anchor-lang, anchor-spl, etc set to match Anchor CLI version (for example anchor-lang = "0.30.0" if using Anchor CLI v0.30.0)

‚ö†Ô∏è What you have and where mismatch appears

In your logs:

    Anchor CLI version: anchor-cli 0.26.0 (you showed this)

    You switched Rust toolchains and got Rustc versions of 1.79.0, 1.84.1, etc

    Cargo version ~1.84.1

    You still get the lock file version 4 requires -Znext-lockfile-bump error ‚Üí this is tied to new Cargo/lockfile versions + version mismatches. (See issue #3392).
    GitHub+1

Mismatches to fix:

    Anchor CLI 0.26.0 is quite old compared to recommended ~0.30+

    Possibly the Solana CLI or embedded Rust toolchain is older (the error about ‚Äúrustc 1.79.0-dev is not supported‚Ä¶‚Äù shows this)
    Stack Overflow+1

    Your Cargo.lock version mismatch indicates dependencies expect a newer lockfile version (version 4) or newer toolchain.

üîß What you should do

Here‚Äôs a step-by-step to align everything:

    Upgrade Anchor CLI
    Use the official install method (or Anchor Version Manager avm) to install latest:

cargo install --git https://github.com/coral-xyz/anchor avm --locked
avm install latest
avm use latest
anchor --version

According to docs, a version like 0.32.1 may be the current stable.
anchor-lang.com+1

Upgrade Solana CLI
Use recommended install script:

sh -c "$(curl -sSfL https://release.solana.com/v1.18.8/install)"  # or a later version
solana --version

This ensures you‚Äôre using at least version ~1.18.x, matching Anchor‚Äôs recommendation. (Release notes for Anchor 0.30.0 say recommended Solana version is 1.18.8)
anchor-lang.com+1

Ensure Rust toolchain is appropriate

    Use rustup to install and set default stable (e.g., rustup default stable)

    Verify rustc --version shows a version compatible (‚â• 1.75.0+).

    Also check for a rust-toolchain.toml or override in your project directory that might force an older toolchain. Some Solana/Anchor builds use a special ‚Äúsolana‚Äù toolchain internally, so it may default to an older Rust version.
    Solana Stack Exchange+1

    If you still get ‚Äúlock file version 4‚Äù errors: regenerate lock file with cargo generate-lockfile and/or delete Cargo.lock and target directory and rebuild.

Update Anchor project dependencies

    In Cargo.toml, set anchor-lang = "0.30.0" (or whichever version matches your Anchor CLI)

    Ensure anchor-spl matches that version too.

    In Anchor.toml, you can optionally specify:

    [toolchain]
    anchor_version = "0.30.0"
    solana_version = "1.18.8"

    As indicated in release notes for older Anchor versions.
    anchor-lang.com

Clean and rebuild

    cargo clean
    cargo generate-lockfile
    anchor build

    This should fix the Failed to parse lock file ‚Ä¶ lock file version 4 issue once everything is aligned.

If you like, I can look up the exact latest stable version numbers right now (as of October 2025) for Anchor CLI, Solana CLI and anchor-lang, so we pick the very latest combination. Would that be helpful?
You said:
yes look it up
ChatGPT said:

Here are the latest stable version numbers (as of October 2025) for the main tools in the Anchor CLI / Solana CLI / Rust stack:

    Anchor CLI: version 0.32.1 is cited as the ‚Äúlatest version‚Äù for installation.
    anchor-lang.com+1

    Solana CLI (via the ‚ÄúAgave‚Äù tool chain) : version v2.3.13 is shown as the recent stable release in the Agave repo.
    GitHub

    Rust compiler: The docs show examples using Rust version 1.86.0 in March 2025.
    Solana

So for your environment you‚Äôd want to align to something like:

    Anchor CLI ‚âà 0.32.1

    Solana CLI ‚âà 2.3.x (or at least latest stable)

    Rust toolchain ‚â• 1.84 (but ideally 1.80+)

If you like, I can pull exact recommended combinations of Anchor CLI + Anchor-crate versions + Solana SDK versions from the Anchor / Solana release notes (with matching compatibility) so you know exactly which versions to set in your project.
You said:
yes
ChatGPT said:

Here are some exact compatibility recommendations for Anchor, Solana CLI / Agave & SDK, Rust toolchain and key crates ‚Äî pulled from release-notes and issue trackers. Use these as a checklist to align your environment.
‚úÖ Key version compatibility matrix
Anchor Version	Recommended Solana Version	Notes / Compatibility Details
Anchor v0.30.0	Solana 1.18.8	Release notes say: ‚ÄúWhile this release supports anything above 1.16, the recommended Solana version is 1.18.8.‚Äù
anchor-lang.com
Anchor v0.31.0	Solana 2.1.0	Release notes say: ‚ÄúThe recommended Solana version is 2.1.0 ‚Ä¶ this is a special upgrade because some of the Solana binaries have been renamed to Agave.‚Äù
anchor-lang.com+1
Anchor v0.32.1 (and anchor-lang v0.32.1)	(not explicitly stated)	anchor-lang‚Äôs Cargo.toml shows version 0.32.1.
Docs.rs+1
Also issue tracker warns: ‚ÄúRunning anchor build on Solana/Agave v2.0+ is broken‚Äù for older Anchor versions.
GitHub
üîç Other relevant compatibility/upgrade notes

    If you‚Äôre using Anchor version below v0.31, then Solana SDK v2 or Agave tooling may not be supported properly. For example: > ‚ÄúNote that v0.29 does not support Solana v2 because it was released before Solana v2.‚Äù
    GitHub

    In the CHANGELOG.md for Anchor: ‚Äúcli: Check anchor-lang and CLI version compatibility (#2753) ‚Ä¶‚Äù indicating that mismatches between CLI, lang crate, and Solana SDK can lead to failures.
    GitHub

    When using edition 2021 crates, workspaces etc: you might see warning ‚Äúsome crates are on edition 2021 which defaults to resolver = "2" ‚Ä¶‚Äù which suggests you should set workspace.resolver = "2" in your Cargo.toml to maintain compatibility.

üìã What you should do right now (based on your errors)

    If you pick Anchor v0.31.0, then aim for Solana CLI/SDK version ~ 2.1.0 (or later stable in that 2.x line).

    Ensure your anchor-lang, anchor-spl, etc crates in your Cargo.toml align with the Anchor version you choose (for example anchor-lang = "0.31.0").

    In your project root Anchor.toml you can specify:

    [toolchain]
    anchor_version = "0.31.0"
    solana_version = "2.1.0"

    (This was introduced in Anchor v0.29.0 onward)
    anchor-lang.com

    Make sure your Rust toolchain (rustc + cargo) is recent enough for the crates: for example, Anchor v0.31+ may depend on Rust 1.82+ (based on error you observed about indexmap v2.12 requiring rustc 1.82) ‚Äî you saw that in your logs.

    Regenerate your Cargo.lock after aligning versions: cargo clean + cargo generate-lockfile then build.

If you like, I can look up for your exact Anchor version (say 0.32.1) what Solana CLI version is documented as supported, and what Rust version the crates require ‚Äî I can pull the specific table or doc lines.
You said:
yes
ChatGPT said:

I checked, but I couldn‚Äôt find a published exact compatibility table for Anchor CLI v0.32.1 (i.e., what Solana version + Rust version it explicitly supports) beyond what‚Äôs available for earlier versions. What I did find:

    For anchor‚Äëlang v0.30.0: The release notes state:

        ‚ÄúWhile this release supports anything above 1.16, the recommended Solana version is 1.18.8.‚Äù
        anchor-lang.com+1

    For Anchor v0.30.1: The notes say:

        ‚ÄúWhile this release supports anything above 1.17.3, the recommended Solana version is 1.18.17.‚Äù
        anchor-lang.com

    For Anchor v0.31.0: The release notes state:

        ‚ÄúThe recommended Solana version is 2.1.0 ‚Ä¶ this is a special upgrade because some of the Solana binaries have been renamed to Agave.‚Äù
        anchor-lang.com

    Also: There are error reports about building with Anchor v0.31.1 that mention the crate solana-program v2.2.1 requires Rust 1.79.0 or newer.
    Solana Stack Exchange+1

So from that we can infer for Anchor v0.32.1:

    It likely supports Solana CLI version 2.x (i.e., 2.1.0 or later) given v0.31.0‚Äôs recommendation.

    It likely requires Rust compiler version ‚â• 1.79.0 (because the solana-program v2.x crates require that).

    Since your environment was complaining about ‚Äúlock file version 4‚Äù and old toolchain versions, this aligns with needing newer Rust + newer Solana.

    The official Installation docs list for Linux/Mac example:

        Rust: rustc 1.84.1 (e71f9a9a9 2025-01-27)

        Solana CLI: solana-cli 2.1.15 ‚Ä¶

        Anchor CLI: anchor-cli 0.32.1
        anchor-lang.com

‚úÖ What I‚Äôd Recommend for Anchor v0.32.1

    Use Solana CLI 2.x, certainly 2.1.0 or higher.

    Use Rustc ‚â• 1.79.0, preferably something like 1.84.x since that appears in the install docs.

    Update your Cargo.toml / Anchor.toml to specify the [toolchain] block:

    [toolchain]
    anchor_version = "0.32.1"
    solana_version = "2.1.0"

    (or a slightly later Solana version if you prefer)

    Regenerate Cargo.lock and clean your build environment once you align those.

If you like, I can check the GitHub issues for Anchor v0.32.x and see if there are any reported incompatibilities or exact ‚Äúminimum‚Äù Rust version lines in the code/docs. Would you like me to dig those up?
You said:
yes check
ChatGPT said:

Here are relevant findings from GitHub/issue-tracker sources about version compatibility for the Anchor framework (especially around v0.31.x & v0.32.x) and what they imply for your setup:
üîç Key issue evidence

    There is a GitHub issue titled ‚ÄúFresh project anchor build fails with ‚Äúlock file version 4 requires -Znext-lockfile-bump‚Äù for Anchor. It‚Äôs reported that this occurs because Anchor v0.30 uses Solana v1.18, and that in turn depends on a Rust version (or lock‚Äêfile format) that leads to this issue.
    GitHub

    On Solana SDK v2.x crates (e.g., solana‚Äêprogram v2.2.1), there is a StackExchange thread stating:

        ‚Äúerror: package solana-program v2.2.1 cannot be built because it requires rustc 1.79.0 or newer, while the currently active rustc version is 1.75.0-dev.‚Äù
        Solana Stack Exchange+1

        This indicates that for Anchor versions which pull in Solana SDK v2.x, you must have rustc ‚â• 1.79.0.

    The release notes for Anchor v0.31.0 explicitly say:

        ‚ÄúThe recommended Solana version is 2.1.0 ‚Ä¶‚Äù
        GitHub+1

        That aligns with Solana SDK v2.x and therefore the Rust version constraint above.

    Though I did not locate a single statement in the docs that for Anchor v0.32.1 ‚ÄúMinimum Rust version is X‚Äù, the above issue threads strongly imply:

        For Anchor v0.31.x and onwards (which support Solana SDK v2.x), you must use rustc 1.79.0+

        If you remain on older Anchor (v0.30.x) with Solana SDK v1.18, the minimum rustc is lower (for example 1.75.0 in some threads)
        Solana Stack Exchange+1

‚úÖ Summary for your situation

Given the evidence:

    If you upgrade to Anchor CLI / crates v0.31.x or v0.32.x (which seem to target Solana SDK v2.x), you must ensure your Rust toolchain is at least rustc 1.79.0.

    Using older rustc (1.75 or 1.72 etc) will cause build failures because the Solana SDK v2.x crates require a newer compiler.

    Also, you‚Äôll want to match the Solana CLI/SDK version‚ÄîAnchor v0.31.x recommends Solana CLI ~ 2.1.0.

    The ‚Äúlock file version 4‚Äù error indicates a mismatch between the Cargo lock file version and the Rust/cargo toolchain version that understands it. Regenerating the lock file under a newer toolchain helps (and you attempted that). Also aligning Anchor/SDK versions avoids the mismatch.

If you like, I can check the Anchor v0.32.1 release notes or changelog to see if there is a defined minimum Rust version line for that release.


ChatGPT can make mistakes. Check important info.
